name: 'nais SLSA Provenance Action'
description: 'Action to generate signed SLSA provenance'
branding:
  icon: lock
  color: red
inputs:

  repo_dir:
    description: |-
      Internal value (do not set): Root of directory to look for build files.
      Defaults to $GITHUB_WORKSPACE.
    required: false
    default: ${{ github.workspace }}

  repo_sub_dir:
    description: |-
      Specify a sub directory if build file not found in working root directory
    required: false
    default: ""

  repo_name:
    description: |-
      Name of the file and path to provenance. Used as an relative path under $GITHUB_WORKSPACE.
      Defaults to "github.repository".
    required: false
    default: ${{ github.repository }}

  key:
    description: |-
      The key used to sign the attestation
    required: true

  docker_user:
    description: |-
      User to login to docker. Use by default "github.actor".
    required: false
    default: ""

  docker_pwd:
    description: |-
      Pwd to login to docker
    required: true

  dependencies:
    description: |-
      if the provenance should contain dependecies
    required: false
    default: "true"

  image:
    description: |-
      docker image to sign.
    required: true

  github_context:
    description: |-
      Internal value (do not set): the "github" context object in json.
      The context is used when generating provenance.
    required: false
    default: ${{ toJSON(github) }}

  runner_context:
    description: |-
      Internal value (do not set): the "runner" context object in json.
      The context is used when generating provenance.
    required: false
    default: ${{ toJSON(runner) }}

runs:
  using: 'docker'
  image: 'docker://ghcr.io/nais/salsa:v0.1'
  args:
    - ${{ inputs.repo_dir }}
    - ${{ inputs.repo_name }}
    - ${{ inputs.github_context }}
    - ${{ inputs.runner_context }}
    - ${{ inputs.image }}
    - ${{ inputs.env_context }}
    - ${{ inputs.repo_sub_dir }}
    - ${{ inputs.key }}
    - ${{ inputs.docker_user }}
    - ${{ inputs.docker_pwd }}
    - ${{ inputs.dependencies }}
